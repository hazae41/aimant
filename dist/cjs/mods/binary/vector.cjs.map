{"version":3,"file":"vector.cjs","sources":["../../../../src/mods/binary/vector.ts"],"sourcesContent":["import { Binary } from \"libs/binary.js\";\nimport { NumberX } from \"mods/binary/number.js\";\nimport { Readable } from \"mods/binary/readable.js\";\nimport { Writable } from \"mods/binary/writable.js\";\n\nexport interface Vector<L extends NumberX = any> extends Writable {\n  readonly vlength: L[\"class\"]\n}\n\nexport const SizedBufferVector = <L extends NumberX = any>(vlength: L[\"class\"]) => class {\n  readonly class = SizedBufferVector(vlength)\n\n  constructor(\n    readonly buffer: Buffer\n  ) { }\n\n  get vlength() {\n    return vlength\n  }\n\n  static empty() {\n    return new this(Buffer.allocUnsafe(0))\n  }\n\n  size() {\n    return vlength.size + this.buffer.length\n  }\n\n  write(binary: Binary) {\n    new vlength(this.buffer.length).write(binary)\n\n    binary.write(this.buffer)\n  }\n\n  static read(binary: Binary) {\n    const length = vlength.read(binary).value\n    const buffer = binary.read(length)\n\n    return new this(buffer)\n  }\n}\n\nexport class BufferVector<L extends NumberX = any> {\n  readonly class = BufferVector<L>\n\n  constructor(\n    readonly buffer: Buffer,\n    readonly vlength: L[\"class\"],\n  ) { }\n\n  static empty<L extends NumberX = any>(length: L[\"class\"]) {\n    return new this(Buffer.allocUnsafe(0), length)\n  }\n\n  size() {\n    return this.vlength.size + this.buffer.length\n  }\n\n  write(binary: Binary) {\n    new this.vlength(this.buffer.length).write(binary)\n\n    binary.write(this.buffer)\n  }\n\n  static read<L extends NumberX = any>(binary: Binary, vlength: L[\"class\"]) {\n    const length = vlength.read(binary).value\n    const buffer = binary.read(length)\n\n    return new this(buffer, vlength)\n  }\n}\n\nexport class AnyVector<L extends NumberX = any, T extends Writable = any> {\n  readonly class = AnyVector<L>\n\n  constructor(\n    readonly value: T,\n    readonly vlength: L[\"class\"],\n  ) { }\n\n  size() {\n    return this.vlength.size + this.value.size()\n  }\n\n  write(binary: Binary) {\n    new this.vlength(this.value.size()).write(binary)\n\n    this.value.write(binary)\n  }\n}\n\nexport class ArrayVector<L extends NumberX = any, T extends Writable = any> {\n  readonly class = ArrayVector<L, T>\n\n  constructor(\n    readonly array: T[],\n    readonly vlength: L[\"class\"],\n  ) { }\n\n  size() {\n    let size = this.vlength.size\n\n    for (const element of this.array)\n      size += element.size()\n\n    return size\n  }\n\n  write(binary: Binary) {\n    let size = 0\n\n    for (const element of this.array)\n      size += element.size()\n\n    new this.vlength(size).write(binary)\n\n    for (const element of this.array)\n      element.write(binary)\n  }\n\n  static read<L extends NumberX = any, T extends Writable & Readable<T> = any>(binary: Binary, vlength: L[\"class\"], type: T[\"class\"]) {\n    const start = binary.offset\n\n    const length = vlength.read(binary).value\n\n    const array = new Array<T>()\n\n    while (binary.offset - start < length)\n      array.push(type.read(binary))\n\n    return new this(array, vlength)\n  }\n}\n\nexport class Vector8<L extends NumberX = any> {\n  readonly class = Vector8<L>\n\n  constructor(\n    readonly array: number[],\n    readonly vlength: L[\"class\"],\n  ) { }\n\n  size() {\n    return this.vlength.size + this.array.length\n  }\n\n  write(binary: Binary) {\n    new this.vlength(this.array.length).write(binary)\n\n    for (const element of this.array)\n      binary.writeUint8(element)\n  }\n}\n\nexport class Vector16<L extends NumberX = any> {\n  readonly class = Vector16<L>\n\n  constructor(\n    readonly array: number[],\n    readonly vlength: L[\"class\"],\n  ) { }\n\n  size() {\n    return this.vlength.size + (this.array.length * 2)\n  }\n\n  write(binary: Binary) {\n    new this.vlength(this.array.length * 2).write(binary)\n\n    for (const element of this.array)\n      binary.writeUint16(element)\n  }\n}"],"names":[],"mappings":"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"}