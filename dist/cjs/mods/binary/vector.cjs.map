{"version":3,"file":"vector.cjs","sources":["../../../../src/mods/binary/vector.ts"],"sourcesContent":["import { Binary } from \"libs/binary.js\";\nimport { NumberX } from \"mods/binary/number.js\";\nimport { Readable } from \"mods/binary/readable.js\";\nimport { Writable } from \"mods/binary/writable.js\";\n\nexport interface Vector<L extends NumberX> extends Writable {\n  readonly vlength: L[\"class\"]\n}\n\nexport type BufferVector<L extends NumberX,> =\n  InstanceType<ReturnType<typeof BufferVector<L>>>\n\nexport const BufferVector = <L extends NumberX>(vlength: L[\"class\"]) => class {\n  readonly class = BufferVector(vlength)\n\n  constructor(\n    readonly buffer: Buffer\n  ) { }\n\n  get vlength() {\n    return vlength\n  }\n\n  static empty() {\n    return new this(Buffer.allocUnsafe(0))\n  }\n\n  size() {\n    return vlength.size + this.buffer.length\n  }\n\n  write(binary: Binary) {\n    new vlength(this.buffer.length).write(binary)\n\n    binary.write(this.buffer)\n  }\n\n  static read(binary: Binary) {\n    const length = vlength.read(binary).value\n    const buffer = binary.read(length)\n\n    return new this(buffer)\n  }\n}\n\nexport const AnyVector = <L extends NumberX = any>(vlength: L[\"class\"]) => class <T extends Writable = any> {\n  readonly class = AnyVector(vlength)\n\n  constructor(\n    readonly value: T\n  ) { }\n\n  get vlength() {\n    return vlength\n  }\n\n  size() {\n    return vlength.size + this.value.size()\n  }\n\n  write(binary: Binary) {\n    new vlength(this.value.size()).write(binary)\n\n    this.value.write(binary)\n  }\n}\n\nexport type ArrayVector<L extends NumberX, T extends Writable & Readable<T>> =\n  InstanceType<ReturnType<typeof ArrayVector<L, T>>>\n\nexport const ArrayVector = <L extends NumberX, T extends Writable & Readable<T>>(vlength: L[\"class\"], type: T[\"class\"]) => class {\n  readonly class = ArrayVector(vlength, type)\n\n  constructor(\n    readonly array: T[]\n  ) { }\n\n  get vlength() {\n    return vlength\n  }\n\n  size() {\n    let size = vlength.size\n\n    for (const element of this.array)\n      size += element.size()\n\n    return size\n  }\n\n  write(binary: Binary) {\n    let size = 0\n\n    for (const element of this.array)\n      size += element.size()\n\n    new vlength(size).write(binary)\n\n    for (const element of this.array)\n      element.write(binary)\n  }\n\n  static read(binary: Binary) {\n    const length = vlength.read(binary).value\n\n    const start = binary.offset\n    const array = new Array<T>()\n\n    while (binary.offset - start < length)\n      array.push(type.read(binary))\n\n    if (binary.offset - start !== length)\n      throw new Error(`Invalid vector length`)\n\n    return new this(array)\n  }\n}\n\nexport const Vector8 = <L extends NumberX>(vlength: L[\"class\"]) => class {\n  readonly class = Vector8(vlength)\n\n  constructor(\n    readonly array: number[]\n  ) { }\n\n  get vlength() {\n    return vlength\n  }\n\n  size() {\n    return vlength.size + this.array.length\n  }\n\n  write(binary: Binary) {\n    new vlength(this.array.length).write(binary)\n\n    for (const element of this.array)\n      binary.writeUint8(element)\n  }\n}\n\nexport const Vector16 = <L extends NumberX>(vlength: L[\"class\"]) => class {\n  readonly class = Vector16(vlength)\n\n  constructor(\n    readonly array: number[]\n  ) { }\n\n  get vlength() {\n    return vlength\n  }\n\n  size() {\n    return vlength.size + (this.array.length * 2)\n  }\n\n  write(binary: Binary) {\n    new vlength(this.array.length * 2).write(binary)\n\n    for (const element of this.array)\n      binary.writeUint16(element)\n  }\n}"],"names":[],"mappings":"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"}