{"version":3,"file":"handshake.cjs","sources":["../../../../../src/mods/binary/handshakes/handshake.ts"],"sourcesContent":["import { Binary } from \"libs/binary.js\"\nimport { Record } from \"mods/binary/record/record.js\"\nimport { Writable } from \"mods/binary/writable.js\"\n\nexport interface IHandshake extends Writable {\n  type: number\n}\n\nexport class HandshakeHeader {\n  constructor(\n    readonly type: number,\n    readonly length: number\n  ) { }\n\n  size() {\n    return 1 + 3\n  }\n\n  write(binary: Binary) {\n    binary.writeUint8(this.type)\n    binary.writeUint24(this.length)\n  }\n\n  static read(binary: Binary, length: number) {\n    const start = binary.offset\n\n    const type = binary.readUint8()\n    const sublength = binary.readUint24()\n\n    if (binary.offset - start !== length - sublength)\n      throw new Error(`Invalid ${this.name} length`)\n\n    return new this(type, sublength)\n  }\n}\n\nexport class Handshake {\n  readonly class = Handshake\n\n  static type = Record.types.handshake\n\n  static types = {\n    client_hello: 1,\n    server_hello: 2\n  }\n\n  constructor(\n    readonly subtype: number,\n    readonly fragment: Writable\n  ) { }\n\n  get type() {\n    return this.class.type\n  }\n\n  static from(handshake: IHandshake) {\n    return new this(handshake.type, handshake)\n  }\n\n  size() {\n    return 1 + 3 + this.fragment.size()\n  }\n\n  write(binary: Binary) {\n    binary.writeUint8(this.subtype)\n    binary.writeUint24(this.fragment.size())\n    this.fragment.write(binary)\n  }\n\n  record(version: number) {\n    return Record.from(this, version)\n  }\n}"],"names":["Record"],"mappings":";;;;MAQa,eAAe,CAAA;IAC1B,WACW,CAAA,IAAY,EACZ,MAAc,EAAA;QADd,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAQ;QACZ,IAAM,CAAA,MAAA,GAAN,MAAM,CAAQ;KACpB;IAEL,IAAI,GAAA;QACF,OAAO,CAAC,GAAG,CAAC,CAAA;KACb;AAED,IAAA,KAAK,CAAC,MAAc,EAAA;AAClB,QAAA,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;AAC5B,QAAA,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;KAChC;AAED,IAAA,OAAO,IAAI,CAAC,MAAc,EAAE,MAAc,EAAA;AACxC,QAAA,MAAM,KAAK,GAAG,MAAM,CAAC,MAAM,CAAA;AAE3B,QAAA,MAAM,IAAI,GAAG,MAAM,CAAC,SAAS,EAAE,CAAA;AAC/B,QAAA,MAAM,SAAS,GAAG,MAAM,CAAC,UAAU,EAAE,CAAA;QAErC,IAAI,MAAM,CAAC,MAAM,GAAG,KAAK,KAAK,MAAM,GAAG,SAAS;YAC9C,MAAM,IAAI,KAAK,CAAC,CAAA,QAAA,EAAW,IAAI,CAAC,IAAI,CAAS,OAAA,CAAA,CAAC,CAAA;AAEhD,QAAA,OAAO,IAAI,IAAI,CAAC,IAAI,EAAE,SAAS,CAAC,CAAA;KACjC;AACF,CAAA;MAEY,SAAS,CAAA;IAUpB,WACW,CAAA,OAAe,EACf,QAAkB,EAAA;QADlB,IAAO,CAAA,OAAA,GAAP,OAAO,CAAQ;QACf,IAAQ,CAAA,QAAA,GAAR,QAAQ,CAAU;QAXpB,IAAK,CAAA,KAAA,GAAG,SAAS,CAAA;KAYrB;AAEL,IAAA,IAAI,IAAI,GAAA;AACN,QAAA,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAA;KACvB;IAED,OAAO,IAAI,CAAC,SAAqB,EAAA;QAC/B,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,SAAS,CAAC,CAAA;KAC3C;IAED,IAAI,GAAA;QACF,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAA;KACpC;AAED,IAAA,KAAK,CAAC,MAAc,EAAA;AAClB,QAAA,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;QAC/B,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAA;AACxC,QAAA,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,CAAA;KAC5B;AAED,IAAA,MAAM,CAAC,OAAe,EAAA;QACpB,OAAOA,aAAM,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAA;KAClC;;AAhCM,SAAA,CAAA,IAAI,GAAGA,aAAM,CAAC,KAAK,CAAC,SAAS,CAAA;AAE7B,SAAA,CAAA,KAAK,GAAG;AACb,IAAA,YAAY,EAAE,CAAC;AACf,IAAA,YAAY,EAAE,CAAC;CAChB;;;;;"}