{"version":3,"file":"tls.cjs","sources":["../../../src/mods/tls.ts"],"sourcesContent":["import { Binary } from \"libs/binary.js\"\nimport { Alert } from \"mods/binary/alerts/alert.js\"\nimport { ClientHello2 } from \"mods/binary/handshakes/client_hello/handshake2.js\"\nimport { Handshake, HandshakeHeader } from \"mods/binary/handshakes/handshake.js\"\nimport { RecordHeader } from \"mods/binary/record/record.js\"\nimport { Transport } from \"mods/transports/transport.js\"\n\nexport class Tls {\n\n  constructor(\n    readonly transport: Transport,\n    readonly ciphers: number[]\n  ) {\n    transport.addEventListener(\"message\", async (e) => {\n      const message = e as MessageEvent<Buffer>\n      this.onData(message.data)\n    }, { passive: true })\n  }\n\n  async handshake() {\n    const hello = ClientHello2.default(this.ciphers)\n      .handshake()\n      .record(0x0301)\n      .export()\n    await this.transport.send(hello.buffer)\n  }\n\n  async onData(data: Buffer) {\n    console.log(\"<-\", data)\n    const binary = new Binary(data)\n\n    const recordh = RecordHeader.read(binary)\n    console.log(recordh)\n\n    if (recordh.type === Alert.type) {\n      const fragment = Alert.read(binary)\n      console.log(fragment)\n    }\n\n    if (recordh.type === Handshake.type) {\n      const handshakeh = HandshakeHeader.read(binary)\n      console.log(handshakeh)\n    }\n  }\n}"],"names":["__awaiter","ClientHello2","binary","Binary","RecordHeader","Alert","Handshake","HandshakeHeader"],"mappings":";;;;;;;;;MAOa,GAAG,CAAA;IAEd,WACW,CAAA,SAAoB,EACpB,OAAiB,EAAA;QADjB,IAAS,CAAA,SAAA,GAAT,SAAS,CAAW;QACpB,IAAO,CAAA,OAAA,GAAP,OAAO,CAAU;QAE1B,SAAS,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAO,CAAC,KAAIA,eAAA,CAAA,IAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,aAAA;YAChD,MAAM,OAAO,GAAG,CAAyB,CAAA;AACzC,YAAA,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;SAC1B,CAAA,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAA;KACtB;IAEK,SAAS,GAAA;;YACb,MAAM,KAAK,GAAGC,uBAAY,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC;AAC7C,iBAAA,SAAS,EAAE;iBACX,MAAM,CAAC,MAAM,CAAC;AACd,iBAAA,MAAM,EAAE,CAAA;YACX,MAAM,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAA;SACxC,CAAA,CAAA;AAAA,KAAA;AAEK,IAAA,MAAM,CAAC,IAAY,EAAA;;AACvB,YAAA,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;AACvB,YAAA,MAAMC,QAAM,GAAG,IAAIC,aAAM,CAAC,IAAI,CAAC,CAAA;YAE/B,MAAM,OAAO,GAAGC,mBAAY,CAAC,IAAI,CAACF,QAAM,CAAC,CAAA;AACzC,YAAA,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAA;AAEpB,YAAA,IAAI,OAAO,CAAC,IAAI,KAAKG,WAAK,CAAC,IAAI,EAAE;gBAC/B,MAAM,QAAQ,GAAGA,WAAK,CAAC,IAAI,CAACH,QAAM,CAAC,CAAA;AACnC,gBAAA,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;AACtB,aAAA;AAED,YAAA,IAAI,OAAO,CAAC,IAAI,KAAKI,mBAAS,CAAC,IAAI,EAAE;gBACnC,MAAM,UAAU,GAAGC,yBAAe,CAAC,IAAI,CAACL,QAAM,CAAC,CAAA;AAC/C,gBAAA,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,CAAA;AACxB,aAAA;SACF,CAAA,CAAA;AAAA,KAAA;AACF;;;;"}